# Graphite Apache Virtual Host
#
# Generated by Chef
NameVirtualHost *:<%= node['graphite']['port'] %>

<VirtualHost *:<%= node['graphite']['port']%>>
        ServerName <%= node['graphite']['host'] %>
        <% unless node['graphite']['host_aliases'].empty? %>
        ServerAlias <%= [node['graphite']['host_aliases']].flatten.compact.join(" ") %>
        <% end %>
        DocumentRoot "<%= node['graphite']['webapp_dir'] %>"
        ErrorLog <%= node['graphite']['base_dir'] %>/storage/log/webapp/error.log
        CustomLog <%= node['graphite']['base_dir'] %>/storage/log/webapp/access.log common

        <Location "/">
                SetHandler python-program
                PythonPath "['<%= node['graphite']['webapp_dir'] %>'] + sys.path"
                PythonHandler django.core.handlers.modpython
                SetEnv DJANGO_SETTINGS_MODULE graphite.settings
                PythonDebug Off
                PythonAutoReload Off
        </Location>

        <Location "/content/">
                SetHandler None
        </Location>

        <Location "/media/">
                SetHandler None
        </Location>

        <% if node['recipes'].include? "ganglia::web" -%>
	<Location "/ganglia/">
	        SetHandler None
	</Location>
        <% end -%>

        Alias /media/ "/usr/lib/python<%= node['graphite']['python_version'] %>/dist-packages/django/contrib/admin/media/"

</VirtualHost>
